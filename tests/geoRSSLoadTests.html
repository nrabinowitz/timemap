<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TimeMap Basic Load Tests</title>
<link rel="stylesheet" type="text/css" href="../jsUnit/css/jsUnitStyle.css">
<script language="JavaScript" type="text/javascript" src="../../jsunit/app/jsUnitCore.js"></script><script src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAASI0kCI-azC8RgbOZzWc3VRQHs9wgZpGwRjGwil_qtDm9gEic5BTUz8hqqsNZYYfvNUhOqSJ-Bmk30A"
      type="text/javascript"></script>
    <script type="text/javascript" src="http://simile.mit.edu/timeline/api/timeline-api.js"></script>
    <script src="../timemap.js" type="text/javascript"></script>
    <script src="../georssparser.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">

function exposeTestFunctionNames() {
    return [
        'testDatasetsAreDefined',
        'testRSSItemLoaded',
        'testRSSEarliestDate',
        'testRSSItemAttributes',
        'testAtomItemLoaded',
        'testAtomEarliestDate',
        'testAtomItemAttributes',
        'testMixedItemsLoaded',
        'testMixedPlacemarksFound'
    ];
}

function testDatasetsAreDefined() {
    assertNotUndefined("RSS dataset is defined", tm.datasets["rss"]);
    assertNotUndefined("Atom dataset is defined", tm.datasets["atom"]);
}

function testRSSItemLoaded() {
    var ds = tm.datasets["rss"];
    assertEquals("one item in item array", ds.getItems().length, 1);
}

function testRSSEarliestDate() {
    var ds = tm.datasets["rss"];
    assertEquals("year matches", ds.eventSource.getEarliestDate().getFullYear(), 1980);
    assertEquals("month matches", ds.eventSource.getEarliestDate().getMonth(), 0);
    // Timeline seems to adjust for the timezone after parsing :(
    assertEquals("day matches", ds.eventSource.getEarliestDate().getDate(), 1);
}

function testRSSItemAttributes() {
    var items = tm.datasets["rss"].getItems();
    var item = items[0];
    assertEquals("title matches", item.getTitle(), "Test Event");
    assertEquals("placemark type matches", item.getType(), "marker");
    var point = new GLatLng(23.456, 12.345);
    assertTrue("point matches", item.getInfoPoint().equals(point));
}

function testAtomItemLoaded() {
    var ds = tm.datasets["atom"];
    assertEquals("one item in item array", ds.getItems().length, 1);
}

function testAtomEarliestDate() {
    var ds = tm.datasets["atom"];
    assertEquals("year matches", ds.eventSource.getEarliestDate().getFullYear(), 1980);
    assertEquals("month matches", ds.eventSource.getEarliestDate().getMonth(), 0);
    // Timeline seems to adjust for the timezone after parsing :(
    assertEquals("day matches", ds.eventSource.getEarliestDate().getDate(), 1);
}

function testAtomItemAttributes() {
    var items = tm.datasets["atom"].getItems();
    var item = items[0];
    assertEquals("title matches", item.getTitle(), "Test Event");
    assertEquals("placemark type matches", item.getType(), "marker");
    var point = new GLatLng(23.456, 12.345);
    assertTrue("point matches", item.getInfoPoint().equals(point));
}

function testMixedItemsLoaded() {
    var ds = tm.datasets["mixed"];
    assertEquals("four items in item array", 4, ds.getItems().length);
}

function testMixedPlacemarksFound() {
    var items = tm.datasets["mixed"].getItems();
    var pmTypes = ['GeoRSS-Simple','GML (pos)','GML (coordinates)','W3C Geo'];
    for (x=0; x<items.length; x++) {
        var item = items[x];
        assertEquals(pmTypes[x] + ": placemark type matches", item.getType(), "marker");
        var point = new GLatLng(23.456, 12.345);
        assertTrue(pmTypes[x] + ": point matches", item.getInfoPoint().equals(point));
    }
}


var tm = null;

function setUpPage() {
    tm = TimeMap.init({
        mapId: "map",               // Id of map div element (required)
        timelineId: "timeline",     // Id of timeline div element (required) 
        datasets: [
            {
                title: "Test Dataset: RSS",
                id: "rss",
                data: {
                    type: "georss",
                    url: "data/data.rss" 
                }
            },
            {
                title: "Test Dataset: Atom",
                id: "atom",
                data: {
                    type: "georss",
                    url: "data/data-atom.xml" 
                }
            },
            {
                title: "Test Dataset: RSS, mixed formats",
                id: "mixed",
                data: {
                    type: "georss",
                    url: "data/data-mixed.xml" 
                }
            }
        ],
        dataDisplayedFunction: function() { setUpPageStatus = "complete"; }
    });
}

</script>
<link href="tests.css" type="text/css" rel="stylesheet"/>
</head>

<body>
<h1>TimeMap Tests</h1>

<p>This page contains tests for the jsUnit unit testing framework. It assumes that you have the jsunit directory in the same directory as timemap - change the path to jsunit if necessary.</p>

<div id="timemap">
    <div id="timelinecontainer">
      <div id="timeline"></div>
    </div>
    <div id="mapcontainer">
      <div id="map"></div>
    </div>
</div>


</body>
</html>
